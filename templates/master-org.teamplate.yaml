AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: "This CloudFormation template sets up AWS apps."
Metadata:
  QuickStartDocumentation:
    EntrypointName: "Parameters for deploying AWS"
  AWS::CloudFormation::Interface:
    ParameterGroups:
      - Label:
          default: "1.1 Access configuration (required)"
        Parameters:
          - Section1SumoLogicDeployment
          - Section1SumoLogicAccessID
          - Section1SumoLogicAccessKey
          - Section1SumoLogicOrganizationId
          - Section1SumoLogicResourceRemoveOnDeleteStack
          - Section1SecurityToolingAccountId
          - SecurityToolingAccountRegion
          - Section1LogArchivingAccountId
          - LogArchivingAccountRegion
          - Section1OrganizationID
          - Section1OrganizationUnitID
          - LoggingOrganizationUnitID
      - Label:
          default: "1.2 S3 Delivery Bucket configuration (required)"
        Parameters:
          - Section1DeliveryBucketPrefix  
      - Label:
          default: "2.1 GuardDuty App configuration"
        Parameters:
          - Section2InstallSumoGuardDutyApps 
          - Section2InstallAWSGuardDutyApp
      - Label:
          default: "2.2 GuardDuty Attributes"
        Parameters:
          - Section2AutoEnableS3Logs
          - Section2FindingPublishingFrequency
      - Label:
          default: "2.3 GuardDuty Regions configuration"
        Parameters:
          - Section2GuardDutyRegions
      - Label:
          default: "2.4 GuardDuty log-source configuration"
        Parameters:
          - Section2GuardDutyCreateHttpLogsSource
          - Section2GuardDutyHttpLogsSourceCategoryName

      # CloudTrail parameters
      - Label:
          default: "3. CloudTrail Configuration"
        Parameters:
          - CloudTrailRegions
          - InstallCloudTrailApp
          - InstallPCICloudTrailApp
          - InstallCISFoundationApp
          - InstallCloudTrailMonitoringAnalyticsApp
          - InstallCloudTrailSecOpsApp
          - CloudTrailBucketPathExpression
          - CloudTrailLogsSourceCategoryName

      - Label:
          default: "AWS Quick Start configuration"
        Parameters:
          - QSS3BucketName
          - QSS3BucketRegion
          - QSS3KeyPrefix

    ParameterLabels:
      Section1SumoLogicDeployment:
        default: "Sumo Logic deployment name"
      Section1SumoLogicAccessID:
        default: "Sumo Logic access ID"
      Section1SumoLogicAccessKey:
        default: "Sumo Logic access key"
      Section1SumoLogicOrganizationId:
        default: "Sumo Logic organization ID"
      Section1SumoLogicResourceRemoveOnDeleteStack:
        default: "Delete Sumo Logic resources when stack is deleted"
      Section1SecurityToolingAccountId:
        default: "Security tooling account ID"
      SecurityToolingAccountRegion:
        default: "Security tooling account Region"
      Section1LogArchivingAccountId:
        default: "Log archiving account ID"
      LogArchivingAccountRegion:
        default: "Log archiving account Region"
      Section1OrganizationID:
        default: "AWS Organizations ID"
      Section1OrganizationUnitID:
        default: "Organization unit (OU) ID of security tooling account"
      LoggingOrganizationUnitID:
        default: "Organization unit (OU) ID of log archiving account"
      Section1DeliveryBucketPrefix:
        default: "Delivery Bucket Prefix"

      # GuardDuty apps parameters
      Section2InstallAWSGuardDutyApp:
        default: "Install AWS GuardDuty app"
      Section2InstallSumoGuardDutyApps:
        default: "Install Sumo Logic GuardDuty app"       
      Section2GuardDutyCreateHttpLogsSource:
        default: "Create Sumo Logic HTTP logs source"
      Section2GuardDutyHttpLogsSourceCategoryName:
        default: "Sumo Logic HTTP logs source category name"
      Section2AutoEnableS3Logs:
        default: "Auto Enable S3 Logs"
      Section2FindingPublishingFrequency:
        default: "Finding Publishing Frequency"
      Section2GuardDutyRegions:
        default: "GuardDuty Regions"

      # CloudTrail parameters
      CloudTrailRegions:
        default: "CloudTrail Regions of Management Account"
      InstallCloudTrailApp:
        default: "Install Sumo Logic AWS CloudTrail app"
      InstallPCICloudTrailApp:
        default: "Install Sumo Logic PCI compliance for AWS CloudTrail app"
      InstallCISFoundationApp:
        default: "Install Sumo Logic CIS AWS Foundations Benchmark app"
      InstallCloudTrailMonitoringAnalyticsApp:
        default: "Install Amazon CloudTrail - Sumo Cloud Security Monitoring and Analytics App"
      InstallCloudTrailSecOpsApp:
        default: "Install Sumo Global Intelligence for AWS CloudTrail SecOps App"
      CloudTrailBucketPathExpression:
        default: "Path expression for logs"
      CloudTrailLogsSourceCategoryName:
        default: "Sumo Logic CloudTrail logs source category name"

    # QuickStart Bucket Configuration
      QSS3BucketName:
        default: "Quick Start S3 bucket name"
      QSS3BucketRegion:
        default: "Quick Start S3 bucket region"
      QSS3KeyPrefix:
        default: "Quick Start S3 key prefix"
Parameters:
  Section1SumoLogicDeployment:
    Type: String
    AllowedValues:
      - au
      - ca
      - de
      - eu
      - jp
      - us2
      - us1
      - in
      - fed
    Description: "Enter the geographic location of the deployment: au, ca, de, eu, jp, us2, in, fed, or us1."
    Default: 'us2'
  Section1SumoLogicAccessID:
    Type: String
    Description: "Enter the Sumo Logic console access ID, which you received when you created the access key."
    AllowedPattern: ".+"
    ConstraintDescription: "Sumo Logic access ID cannot be empty."

  Section1SumoLogicAccessKey:
    Type: String
    Description: "Enter your Sumo Logic access key. Retrieve this from your Sumo Logic account."
    AllowedPattern: ".+"
    ConstraintDescription: "Sumo Logic access key cannot be empty."
    NoEcho: true

  Section1SumoLogicOrganizationId:
    Description: "Enter your Sumo Logic organization ID, which you can find in the Sumo Logic console, under Account."
    Type: String
    AllowedPattern: ".+"
    ConstraintDescription: "Sumo Logic organization ID cannot be empty."

  Section1SumoLogicResourceRemoveOnDeleteStack:
    AllowedValues:
      - 'true'
      - 'false'
    Default: 'true'
    Description: "If this parameter is set to true, the collector, sources, and Sumo Logic apps are deleted.
                  If this parameter is set to false, then the collector, sources, and Sumo Logic apps are not deleted."
    Type: String
  Section1SecurityToolingAccountId:
    Description: "Enter your security tooling account ID"
    Type: String
    AllowedPattern: '^\d{12}$'
    ConstraintDescription: "Security tooling account ID cannot be empty. Must be 12 digits"
  
  SecurityToolingAccountRegion:
    Description: "Enter your security tooling account region"
    Type: String

  Section1LogArchivingAccountId:
    Description: "Enter your log archiving account ID"
    Type: String
    AllowedPattern: '^\d{12}$'
    ConstraintDescription: "Log archiving account ID cannot be empty. Must be 12 digits"
 
  LogArchivingAccountRegion:
    Description: "Enter your log archiving account region"
    Type: String

  Section1OrganizationID:
    AllowedPattern: '^o-[a-z0-9]{10,32}$'
    Description: >
      The Org Id must be a 12 character string starting with o- and followed by 10 lower case alphanumeric characters
    MaxLength: 12
    MinLength: 12
    Type: String

  Section1OrganizationUnitID:
    Description: >
      Organizational unit (OU) ID of Security Tooling Account where KMS will install - A string that begins with "ou-" followed by from 4 to 32 lowercase letters or digits (the ID of the root that the OU is in). This string is followed by a second "-" dash and from 8 to 32 additional lowercase letters or digits  
    AllowedPattern: '^ou-[0-9a-z]{4,32}-[a-z0-9]{8,32}$'
    MaxLength: 100
    MinLength: 16
    Type: String

  LoggingOrganizationUnitID:
    Description: >
      Organizational unit (OU) ID of log archiving account where S3 bucket will install - A string that begins with "ou-" followed by from 4 to 32 lowercase letters or digits (the ID of the root that the OU is in). This string is followed by a second "-" dash and from 8 to 32 additional lowercase letters or digits  
    AllowedPattern: '^ou-[0-9a-z]{4,32}-[a-z0-9]{8,32}$'
    MaxLength: 100
    MinLength: 16
    Type: String


  Section1DeliveryBucketPrefix:
    AllowedPattern: "^$|^[0-9a-zA-Z]+([0-9a-zA-Z-]*[0-9a-zA-Z])*$"
    ConstraintDescription:
      S3 bucket name can include numbers, lowercase letters, uppercase letters, and hyphens (-).
      It cannot start or end with a hyphen (-).
    Default: 'logs-delivery'
    Description: >
      Log Delivery S3 bucket prefix.
      The account and region will get added to the end. e.g. logs-delivery-123456789012-us-east-1
    Type: String

  # GuardDuty apps parameters
  Section2InstallAWSGuardDutyApp:
    Type: String
    Description: "Yes: Install AWS GuardDuty app.
                  No: Skip installation of app."
    Default: 'Yes'
    AllowedValues:
      - 'Yes'
      - 'No'  
  Section2InstallSumoGuardDutyApps:
    Type: String
    Description: "GuardDuty: Install Sumo Amazon GuardDuty app.
                  GlobalGuardDutyApp: Install Sumo Global Intelligence for Amazon GuardDuty app.
                  Both: Install both apps.
                  Skip: Skip installation of apps."
    Default: 'Both'
    AllowedValues:
      - 'GuardDuty'
      - 'GlobalGuardDuty'
      - 'Both'
      - 'Skip'
  Section2GuardDutyCreateHttpLogsSource:
    Type: String
    Description: "Yes: Create Sumo Logic HTTP log source to collect GuardDuty logs.
                  No: Skip creation of the Sumo Logic HTTP log source."
    Default: 'Yes'
    AllowedValues:
      - 'Yes'
      - 'No'
  Section2GuardDutyHttpLogsSourceCategoryName:
    Type: String
    Description: "Required when Guardduty HTTP LogSource is set to No. Provide an existing source category name from the GuardDuty logs. This is used for app installation."
    Default: "aws/quickstart/guardduty/logs"

  Section2AutoEnableS3Logs:
    AllowedValues: ['true', 'false']
    Default: 'false'
    Description: Auto enable S3 logs
    Type: String
  Section2FindingPublishingFrequency:
    AllowedValues: ['FIFTEEN_MINUTES', 'ONE_HOUR', 'SIX_HOURS']
    Default: 'FIFTEEN_MINUTES'
    Description: Finding publishing frequency
    Type: String
  Section2GuardDutyRegions:
    Description: Comma delimited list of regions to enable GuardDuty. Leave blank to enable all regions.
    Default: 'us-east-1, us-east-2'
    Type: String

  # CloudTrail parameters
  CloudTrailRegions:
    Type: String
    Default: us-east-1,us-east-2
    Description: "Enter multi management account regions for CloudTrail"
  InstallCloudTrailApp:
    Type: String
    Description: "Yes: Install Sumo Logic AWS CloudTrail app.
                  No: Skip installation of app."
    Default: 'Yes'
    AllowedValues:
      - 'Yes'
      - 'No'
  InstallPCICloudTrailApp:
    Type: String
    Description: "Yes: Install PCI compliance For AWS CloudTrail app.
                  No: Skip installation of app."
    Default: 'Yes'
    AllowedValues:
      - 'Yes'
      - 'No'
  InstallCISFoundationApp:
    Type: String
    Description: "Yes: Install CIS AWS Foundations Benchmark app.
                  No: Skip installation of app."
    Default: 'Yes'
    AllowedValues:
      - 'Yes'
      - 'No'
  InstallCloudTrailMonitoringAnalyticsApp:
    Type: String
    Description: "Yes: Install Amazon CloudTrail - Sumo Cloud Security Monitoring and Analytics App.
                  No: Skip installation of app."
    Default: 'Yes'
    AllowedValues:
      - 'Yes'
      - 'No'
  InstallCloudTrailSecOpsApp:
    Type: String
    Description: "Yes: Install Sumo Global Intelligence for AWS CloudTrail SecOps App.
                  No: Skip installation of app."
    Default: 'Yes'
    AllowedValues:
      - 'Yes'
      - 'No'
  CloudTrailBucketPathExpression:
    Type: String
    Description: "Path expression to match the folder structure for CloudTrail logs (e.g., AWSLogs/*/CloudTrail/*)."
    Default: "CloudTrail/AWSLogs/*/CloudTrail/*"
  CloudTrailLogsSourceCategoryName:
    Type: String
    Description: "Required when flag is set to No. Provide an existing source category name from Sumo Logic collecting CloudTrail logs. This is used for Threat Intel for AWS app installation also."
    Default: "AWS/Cloudtrail/Logs"


  # QuickStart parameters
  QSS3BucketName:
    AllowedPattern: "^[0-9a-zA-Z]+([0-9a-zA-Z-]*[0-9a-zA-Z])*$"
    ConstraintDescription: "Quick Start bucket name can include numbers, lowercase letters, uppercase letters, and hyphens (-). It cannot start or end with a hyphen (-)."
    Default: "aws-quickstart"
    Description: "S3 bucket name for the Quick Start assets. This string can include numbers, lowercase letters, uppercase letters, and hyphens (-). It cannot start or end with a hyphen (-)."
    Type: "String"
  QSS3BucketRegion:
    Default: "us-east-1"
    Description: "The AWS Region where the Quick Start S3 bucket (QSS3BucketName) is hosted. When using your own bucket, you must specify this value."
    Type: String
  QSS3KeyPrefix:
    AllowedPattern: "^[0-9a-zA-Z-/]*$"
    ConstraintDescription: "Quick Start key prefix can include numbers, lowercase letters, uppercase letters, hyphens (-), and forward slash (/)."
    Default: "quickstart-sumo-logic-log-centralization/"
    Description: "S3 key prefix for the Quick Start assets. Quick Start key prefix can include numbers, lowercase letters, uppercase letters, hyphens (-), and forward slash (/)."
    Type: "String"

Conditions:


  # Conditions for GuardDuty apps
  install_sumo_guardduty_app: !Or
    - !Equals [ !Ref Section2InstallSumoGuardDutyApps, 'GuardDuty' ]
    - !Equals [ !Ref Section2InstallSumoGuardDutyApps, 'Both' ]
  install_sumo_global_guardduty_app: !Or
    - !Equals [ !Ref Section2InstallSumoGuardDutyApps, 'GlobalGuardDuty' ]
    - !Equals [ !Ref Section2InstallSumoGuardDutyApps, 'Both' ]
  create_guardduty_source: !Equals [ !Ref Section2GuardDutyCreateHttpLogsSource, 'Yes' ]
  install_aws_guardduty_app: !Equals [ !Ref Section2InstallAWSGuardDutyApp, 'Yes' ]

  # Conditions for calling child stack of each app if any resource create condition is true.
  call_guardduty_stack: !Or
    - !Condition install_sumo_guardduty_app
    - !Condition install_sumo_global_guardduty_app
    - !Condition create_guardduty_source
    - !Condition install_aws_guardduty_app
  call_cloudtrail_stack: !Or
    - !Equals [ !Ref InstallCloudTrailApp, 'Yes' ] 
    - !Equals [ !Ref InstallPCICloudTrailApp, 'Yes' ]
    - !Equals [ !Ref InstallCISFoundationApp, 'Yes' ]
    - !Equals [ !Ref InstallCloudTrailMonitoringAnalyticsApp, 'Yes' ]
    - !Equals [ !Ref InstallCloudTrailSecOpsApp, 'Yes' ]


Resources:
  WaitHandle:
    Type: "AWS::CloudFormation::WaitConditionHandle"

  CommonOrgManagement:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: !Sub
        - 'https://${S3Bucket}.s3.${S3Region}.${AWS::URLSuffix}/${QSS3KeyPrefix}apps/sumo-aws-apps/common-org/common-org-management.template.yaml'
        - S3Region:  !Ref 'AWS::Region'
          S3Bucket: !Sub '${QSS3BucketName}-${AWS::Region}'
      Parameters:
        AdministrationRoleName: !Sub 'AdministrationRole-${AWS::StackName}'
        ExecutionRoleRuleName: !Sub 'ExecutionRole-${AWS::StackName}'
        OrganizationUnitID: !Ref Section1OrganizationUnitID
        LoggingOrganizationUnitID: !Ref LoggingOrganizationUnitID
        QSS3BucketName: !Ref QSS3BucketName  
        QSS3BucketRegion: !Ref QSS3BucketRegion 
        QSS3KeyPrefix: !Ref QSS3KeyPrefix
        SumoDeployment: !Ref Section1SumoLogicDeployment
        SumoAccessID: !Ref Section1SumoLogicAccessID
        SumoAccessKey: !Ref Section1SumoLogicAccessKey
        SumoOrganizationId: !Ref Section1SumoLogicOrganizationId
        RemoveSumoResourcesOnDeleteStack: !Ref Section1SumoLogicResourceRemoveOnDeleteStack
        CollectorName: !Sub "aws-quickstart-collector-${AWS::StackName}"
        SecurityToolingAccountId: !Ref Section1SecurityToolingAccountId
        LoggingAccountId: !Ref Section1LogArchivingAccountId
        DeliveryBucketPrefix: !Ref Section1DeliveryBucketPrefix
        SecurityToolingAccountRegion: !Ref SecurityToolingAccountRegion
        LogArchivingAccountRegion: !Ref LogArchivingAccountRegion

#Stackset for GuardDuty Delete Detector Role
  GuardDutyDeleteDetectorRoleStackset:
    Condition: call_guardduty_stack
    DependsOn:
      - "CommonOrgManagement"
    Type: 'AWS::CloudFormation::StackSet'
    Properties:
      StackSetName: !Sub "GuardDuty-Delete-Detector-Role-${AWS::StackName}"
      PermissionModel: SERVICE_MANAGED
      Capabilities:
        - 'CAPABILITY_NAMED_IAM'
        - 'CAPABILITY_IAM'
        - 'CAPABILITY_AUTO_EXPAND' 
      StackInstancesGroup:
        - Regions:
            - !Ref AWS::Region
          DeploymentTargets:
              OrganizationalUnitIds: 
                - !Ref Section1OrganizationUnitID
      TemplateURL: !Sub
        - 'https://${S3Bucket}.s3.${S3Region}.${AWS::URLSuffix}/${QSS3KeyPrefix}apps/sumo-aws-apps/guardduty-org/guardduty-org-delete-detector-role.yaml'
        - S3Region: !Ref 'AWS::Region'
          S3Bucket: !Sub '${QSS3BucketName}-${AWS::Region}'
      AutoDeployment: 
        Enabled: true
        RetainStacksOnAccountRemoval: true
      Parameters: 
        - ParameterKey: 'DeleteDetectorRoleName'
          ParameterValue: !Sub "DeleteDetectorRole-${AWS::StackName}"
        - ParameterKey: 'OrgPrimaryAccountId'
          ParameterValue: !Ref "AWS::AccountId"

#Stack for GuardDuty Configuration
  GuardDutyConfigurationStack:
    Condition: call_guardduty_stack
    DependsOn:
      - "GuardDutyDeleteDetectorRoleStackset"
    Type: 'AWS::CloudFormation::Stack'
    Properties:
      TemplateURL: !Sub
        - 'https://${S3Bucket}.s3.${S3Region}.${AWS::URLSuffix}/${QSS3KeyPrefix}apps/sumo-aws-apps/guardduty-org/guardduty-org-configuration.yaml'
        - S3Region: !Ref 'AWS::Region'
          S3Bucket: !Sub '${QSS3BucketName}-${AWS::Region}'           
      Parameters:
        SumoDeployment: !Ref Section1SumoLogicDeployment
        SumoAccessID: !Ref Section1SumoLogicAccessID
        SumoAccessKey: !Ref Section1SumoLogicAccessKey
        RemoveSumoResourcesOnDeleteStack: !Ref Section1SumoLogicResourceRemoveOnDeleteStack
        InstallSumoGuardDutyApp: !If [install_sumo_guardduty_app, "Yes", "No"]
        InstallSumoGlobalGuardDutyApp: !If [install_sumo_global_guardduty_app, "Yes", "No"]
        CollectorID: !GetAtt CommonOrgManagement.Outputs.SumoCollectorID 
        CreateHttpLogsSource: !If [create_guardduty_source, "Yes", "No"]
        HttpLogsSourceName: !Sub "aws-quickstart-guardduty"
        HttpLogsSourceCategoryName: !If [create_guardduty_source, "aws/quickstart/guardduty/logs", !Ref Section2GuardDutyHttpLogsSourceCategoryName]
        InstallAWSGuardDutyApp: !If [install_aws_guardduty_app, "Yes", "No"]
        AutoEnableS3Logs: !Ref Section2AutoEnableS3Logs
        ConfigurationRoleName: !Sub 'ConfigurationRole-${AWS::StackName}'
        DelegatedAdminAccountId: !Ref AWS::AccountId
        DeleteDetectorRoleName: !Sub 'DeleteDetectorRole-${AWS::StackName}'
        EnabledRegions: !Ref Section2GuardDutyRegions
        FindingPublishingFrequency: !Ref Section2FindingPublishingFrequency 
        KMSKeyArn: !GetAtt CommonOrgManagement.Outputs.OrgDeliveryKMSKeyArn 
        PublishingDestinationBucketName: !GetAtt CommonOrgManagement.Outputs.OrgDeliveryS3BucketArn
        LambdaExecutionRoleName: !Select [ 1, !Split ['/', !GetAtt CommonOrgManagement.Outputs.SumoLogicHelperRoleARN]]
        OrganizationId: !Ref Section1OrganizationID 
        QSS3BucketName: !Ref QSS3BucketName  
        QSS3BucketRegion: !Ref QSS3BucketRegion 
        QSS3KeyPrefix: !Ref QSS3KeyPrefix
        ParentStackName: !Sub 'ParentStack-${AWS::StackName}'
        ParentHelperFunctionArn: !GetAtt CommonOrgManagement.Outputs.SumoLogicLambdaHelperARN
        LogArchivingAccountRegion: !Ref LogArchivingAccountRegion

# Stack for Cloudtrail
  CloudtrailStack:
    Type: AWS::CloudFormation::Stack
    Condition: call_cloudtrail_stack
    Properties:
      TemplateURL: !Sub
        - 'https://${S3Bucket}.s3.${S3Region}.${AWS::URLSuffix}/${QSS3KeyPrefix}apps/sumo-aws-apps/cloudtrail-org/cloudtrail-master.yaml'
        - S3Region:  !Ref 'AWS::Region'
          S3Bucket: !Sub '${QSS3BucketName}-${AWS::Region}'
      Parameters:
        SumoLogicDeployment: !Ref Section1SumoLogicDeployment
        SumoLogicAccessID: !Ref Section1SumoLogicAccessID
        SumoLogicAccessKey: !Ref Section1SumoLogicAccessKey
        SumoLogicResourceRemoveOnDeleteStack: !Ref Section1SumoLogicResourceRemoveOnDeleteStack
        CollectorID: !GetAtt CommonOrgManagement.Outputs.SumoCollectorID
        ExecutionRoleRuleName: !GetAtt CommonOrgManagement.Outputs.ExecutionRoleRuleName
        CloudTrailRegions: !Ref CloudTrailRegions
        InstallCloudTrailApp: !Ref InstallCloudTrailApp
        InstallPCICloudTrailApp: !Ref InstallPCICloudTrailApp
        InstallCISFoundationApp: !Ref InstallCISFoundationApp
        InstallCloudTrailMonitoringAnalyticsApp: !Ref InstallCloudTrailMonitoringAnalyticsApp
        InstallCloudTrailSecOpsApp: !Ref InstallCloudTrailSecOpsApp
        CloudTrailBucketPathExpression: !Ref CloudTrailBucketPathExpression
        CloudTrailLogsSourceCategoryName: !Ref CloudTrailLogsSourceCategoryName
        SNSTopicArn: !GetAtt CommonOrgManagement.Outputs.SNSTopicArn
        CloudTrailLogsBucketName: !GetAtt CommonOrgManagement.Outputs.OrgDeliveryS3BucketArn
        KMSArn: !GetAtt CommonOrgManagement.Outputs.OrgDeliveryKMSKeyArn 
        SumoRoleArn: !GetAtt CommonOrgManagement.Outputs.SumoRoleArn
        SecurityToolingAccountRegion: !Ref SecurityToolingAccountRegion
        LogArchivingAccountRegion: !Ref LogArchivingAccountRegion
        QSS3BucketName: !Ref QSS3BucketName
        QSS3KeyPrefix: !Ref QSS3KeyPrefix
        ParentStackName: !GetAtt CommonOrgManagement.Outputs.StackName
        ResourcePrefix: !Ref "AWS::StackName"