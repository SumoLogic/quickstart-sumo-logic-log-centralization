---
Global:
  TemplatePath: "../../templates/master-org.teamplate.yaml"
  TestProjectName: MasterTemplate
  ParallelTestsRun: 1
Tests:
    # with all new
    # should change name of TestName when you run again.
  - TestName: AllResources01  
    Regions:
      - 'us-west-1'
    Skip: false
    SkipDelete: false
    Parameters:
      Values:
        Section1SumoLogicDeployment: '${ENTERPRISE_DEPLOYMENT}'
        Section1SumoLogicAccessID: '${ENTERPRISE_ACCESS_ID}'
        Section1SumoLogicAccessKey: '${ENTERPRISE_ACCESS_KEY}'
        Section1SumoLogicOrganizationId: '${ENTERPRISE_ORG_ID}'
        QSS3BucketName: '${QSS3BucketName}'
        Section1SumoLogicResourceRemoveOnDeleteStack: 'true'
        # Organization
        Section1SecurityToolingAccountId: '${TOOLING_ACCOUNT_ID}'
        SecurityToolingAccountRegion: '${TOOLING_LOGGING_REGION}'
        Section1LogArchivingAccountId: '${LOGGING_ACCOUNT_ID}'
        LogArchivingAccountRegion: '${TOOLING_LOGGING_REGION}'
        Section1OrganizationID: '${ORG_ID}'
        Section1OrganizationUnitID: '${TOOLING_OU}'
        LoggingOrganizationUnitID: '${LOGGING_OU}'
        # Cloudtrail
        CloudTrailRegions: '${CLOUDTRAIL_GUARDDUTY_REGIONS}'
        InstallCloudTrailApp: 'Yes'
        InstallPCICloudTrailApp: 'Yes'
        InstallCISFoundationApp: 'Yes'
        InstallCloudTrailMonitoringAnalyticsApp: 'Yes'
        InstallCloudTrailSecOpsApp: 'Yes'
        #guardduty
        Section1DeliveryBucketPrefix: "${RESOURCE_PREFIX}"
        Section2InstallSumoGuardDutyApps: 'Both'
        Section2InstallAWSGuardDutyApp: 'Yes'
        Section2AutoEnableS3Logs: 'true'
        Section2GuardDutyRegions: '${CLOUDTRAIL_GUARDDUTY_REGIONS}'
        Section2GuardDutyCreateHttpLogsSource: 'Yes'


    Assertions:
      - AssertType: ResourceExistence
        Assert:
          Resources:
            - WaitHandle
            - CommonOrgManagement.rAdministrationRole
            - CommonOrgManagement.rExecutionRole
            - CommonOrgManagement.rSumoLogicHelperRole
            - CommonOrgManagement.rSumoLogicLambdaHelper
            - CommonOrgManagement.OrgTrustAllStackset
            - CommonOrgManagement.OrgDeliveryKmsKeyStackset
            - CommonOrgManagement.rOrgDeliveryKMSKeyArn
            - CommonOrgManagement.OrgDeliveryS3BucketStackset
            - CommonOrgManagement.rDeliveryS3BucketArn
            - CommonOrgManagement.rSNSTopicArn
            - CommonOrgManagement.rSumoRoleArn
            - CommonOrgManagement.SumoHostedCollector
            - GuardDutyDeleteDetectorRoleStackset
            - GuardDutyConfigurationStack.rConfigurationRole
            - GuardDutyConfigurationStack.OrgSumoCloudWatchEventFunctionStackset
            - GuardDutyConfigurationStack.rAWSGuardDutyCustomResource
            - GuardDutyConfigurationStack.SumoHTTPSource
            - GuardDutyConfigurationStack.sumoGuardDutyApp
            - GuardDutyConfigurationStack.sumoGlobalGuardDutyApp
            - CloudtrailStack.CloudtrailResoucesStackset
            - CloudtrailStack.CreateSumoApps.SumoLogicHelperRole
            - CloudtrailStack.CreateSumoApps.SumoLogicHelperFunction
            - CloudtrailStack.CreateSumoApps.sumoCloudTrailApp
            - CloudtrailStack.CreateSumoApps.sumoPCICloudTrailApp
            - CloudtrailStack.CreateSumoApps.sumoCISFoundationsApp
            - CloudtrailStack.CreateSumoApps.sumMonitoringAnalyticsApp
            - CloudtrailStack.CreateSumoApps.sumSecOpsApp
            - CloudtrailStack.CreateSumoApps.SumoSNSSubscription
            - CloudtrailStack.CreateSumoApps.SumoCloudTrailSource
      - AssertType: OutputsCheck
        Assert:
          Outputs:
            - CommonOrgManagement.StackName
            - CommonOrgManagement.AdministrationRoleArn
            - CommonOrgManagement.ExecutionRoleRuleName
            - CommonOrgManagement.ExecutionRoleArn
            - CommonOrgManagement.SumoLogicLambdaHelperARN
            - CommonOrgManagement.SumoLogicHelperRoleARN
            - CommonOrgManagement.OrgDeliveryKMSKeyArn
            - CommonOrgManagement.SNSTopicArn
            - CommonOrgManagement.OrgDeliveryS3BucketArn
            - CommonOrgManagement.SumoRoleArn
            - CommonOrgManagement.SumoCollectorID

